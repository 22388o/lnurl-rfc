LUD-18: Payer identity in `payRequest` protocol.
================================================

`author: akumaigorodski` `author: hampus_s` `author: fiatjaf`

---

## Specifying payer identity before sending a payment

Payer MAY attach a `payerid` query parameter to LNURL-PAY callback with value set to JSON array:

```diff
- <callback><?|&>amount=<milliSatoshi>
+ <callback><?|&>amount=<milliSatoshi>&payerid=[<identity record>, ...]
```

JSON array may contain one or more records of the following forms:

1. `{ "tag": "name", "value": <free-form string> }`
2. `{ "tag": "pubkey", "value": hex(<randomly generated secp256k1 pubkey>) }`
3. `{ "tag": "auth", "value": hex(<linkingKey>), "sig": hex(sign(utf8ToBytes(<k1>), <linkingPrivKey>)) }`
4. `{ "tag": "identifier", "value": <internet identifier> }`
5. `{ "tag": "email", "value": <email address> }`

## `PayerIDs` record

If `SERVICE` wants to get one or more types of payer identities from `WALLET` then it must alter its JSON response to the first callback to include a `payerIDs` field, as follows:

```diff
 {
   callback: String,
   maxSendable: MilliSatoshi,
   minSendable: MilliSatoshi,
   metadata: String,
+  payerIDs: {
+    "name": Any,
+    "pubkey": Any,
+    "identifier": Any,
+    "email": Any,
+    "auth": {
+       "mandatory": Boolean,
+       "k1": String // hex encoded 32 bytes of challenge
+    ]
+  },
   tag: "payRequest",
 }
```

The mere presence of each key in the `payerIDs` record signals that it CAN be included by `WALLET`. The values don't mean anything and are to be discarded -- with the exception of `auth`, which MUST be an object containing `k1` and `mandatory`. In case `mandatory` is true `WALLET` MUST send the payment with a [lnurl-auth](04.md) key and signature and the tag `auth`.
